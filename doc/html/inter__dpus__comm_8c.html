<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Infrastructure for DPU offloading: /home/gvallee/Projects/DPU_offloading/dpu_offload_service/src/inter_dpus_comm.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Infrastructure for DPU offloading
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">inter_dpus_comm.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;inttypes.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="dpu__offload__types_8h_source.html">dpu_offload_types.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dpu__offload__debug_8h_source.html">dpu_offload_debug.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dpu__offload__envvars_8h_source.html">dpu_offload_envvars.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dpu__offload__event__channels_8h_source.html">dpu_offload_event_channels.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="dpu__offload__service__daemon_8h_source.html">dpu_offload_service_daemon.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for inter_dpus_comm.c:</div>
<div class="dyncontent">
<div class="center"><img src="inter__dpus__comm_8c__incl.png" border="0" usemap="#a_2home_2gvallee_2Projects_2DPU__offloading_2dpu__offload__service_2src_2inter__dpus__comm_8c" alt=""/></div>
<map name="a_2home_2gvallee_2Projects_2DPU__offloading_2dpu__offload__service_2src_2inter__dpus__comm_8c" id="a_2home_2gvallee_2Projects_2DPU__offloading_2dpu__offload__service_2src_2inter__dpus__comm_8c">
<area shape="rect" title=" " alt="" coords="1113,5,1344,61"/>
<area shape="rect" title=" " alt="" coords="5,273,92,300"/>
<area shape="rect" title=" " alt="" coords="1202,348,1285,375"/>
<area shape="rect" title=" " alt="" coords="1305,423,1376,449"/>
<area shape="rect" title=" " alt="" coords="1753,199,1827,225"/>
<area shape="rect" href="dpu__offload__types_8h.html" title=" " alt="" coords="632,273,785,300"/>
<area shape="rect" href="dpu__offload__debug_8h.html" title=" " alt="" coords="1703,117,1861,143"/>
<area shape="rect" href="dpu__offload__envvars_8h.html" title=" " alt="" coords="1852,199,2021,225"/>
<area shape="rect" href="dpu__offload__event__channels_8h.html" title=" " alt="" coords="390,199,609,225"/>
<area shape="rect" href="dpu__offload__service__daemon_8h.html" title=" " alt="" coords="1153,109,1305,151"/>
<area shape="rect" title=" " alt="" coords="1093,348,1177,375"/>
<area shape="rect" title=" " alt="" coords="643,423,793,449"/>
<area shape="rect" title=" " alt="" coords="417,348,587,375"/>
<area shape="rect" title=" " alt="" coords="611,348,681,375"/>
<area shape="rect" href="dynamic__structs_8h.html" title=" " alt="" coords="927,348,1069,375"/>
<area shape="rect" href="dpu__offload__common_8h.html" title=" " alt="" coords="219,348,393,375"/>
<area shape="rect" href="dpu__offload__utils_8h.html" title=" " alt="" coords="757,348,903,375"/>
<area shape="rect" title=" " alt="" coords="531,423,601,449"/>
<area shape="rect" title=" " alt="" coords="1107,423,1182,449"/>
<area shape="rect" title=" " alt="" coords="1206,423,1281,449"/>
<area shape="rect" title=" " alt="" coords="817,423,888,449"/>
<area shape="rect" title=" " alt="" coords="403,423,470,449"/>
<area shape="rect" title=" " alt="" coords="913,423,1083,449"/>
<area shape="rect" title=" " alt="" coords="252,423,360,449"/>
<area shape="rect" title=" " alt="" coords="1633,199,1729,225"/>
<area shape="rect" title=" " alt="" coords="1360,199,1463,225"/>
<area shape="rect" title=" " alt="" coords="1487,199,1557,225"/>
<area shape="rect" title=" " alt="" coords="901,199,997,225"/>
<area shape="rect" title=" " alt="" coords="1021,199,1117,225"/>
<area shape="rect" title=" " alt="" coords="1141,199,1233,225"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3024ccd4a9af5109d24e6c57565d74a1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inter__dpus__comm_8c.html#a3024ccd4a9af5109d24e6c57565d74a1">_POSIX_C_SOURCE</a>&#160;&#160;&#160;200809L</td></tr>
<tr class="separator:a3024ccd4a9af5109d24e6c57565d74a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a580d72718c40903a23a49390e599681b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inter__dpus__comm_8c.html#a580d72718c40903a23a49390e599681b">ADD_LOCAL_SPS_TO_DPU_CONFIG</a>(_cfg,  _dpu)</td></tr>
<tr class="separator:a580d72718c40903a23a49390e599681b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff962075df7d2346d199623f022419c6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inter__dpus__comm_8c.html#aff962075df7d2346d199623f022419c6">SET_REMOTE_SP_TO_CONNECT_TO</a>(_cfg,  _sp_gid)</td></tr>
<tr class="separator:aff962075df7d2346d199623f022419c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e6fbbe70d686f5c32e4399bfd9c4090"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inter__dpus__comm_8c.html#a8e6fbbe70d686f5c32e4399bfd9c4090">SET_SERVICE_PROC_TO_CONNECT_TO</a>(_engine,  _cfg,  _remote_dpu)</td></tr>
<tr class="separator:a8e6fbbe70d686f5c32e4399bfd9c4090"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab07bde402553cc60ac536d085b3623b3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="dpu__offload__types_8h.html#ac95b2624b57c0005e3ca8a740316e5ab">execution_context_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inter__dpus__comm_8c.html#ab07bde402553cc60ac536d085b3623b3">server_init</a> (<a class="el" href="dpu__offload__types_8h.html#abdda2bc51909d3f2e98a5c9dde42b0a8">offloading_engine_t</a> *, <a class="el" href="dpu__offload__types_8h.html#a42c35bf5c92dc98cf22a4818b0331608">init_params_t</a> *)</td></tr>
<tr class="memdesc:ab07bde402553cc60ac536d085b3623b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a connection server.  <a href="inter__dpus__comm_8c.html#ab07bde402553cc60ac536d085b3623b3">More...</a><br /></td></tr>
<tr class="separator:ab07bde402553cc60ac536d085b3623b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0389e761e688d7377daf019885f09fe"><td class="memItemLeft" align="right" valign="top"><a class="el" href="dpu__offload__types_8h.html#ac95b2624b57c0005e3ca8a740316e5ab">execution_context_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inter__dpus__comm_8c.html#ac0389e761e688d7377daf019885f09fe">client_init</a> (<a class="el" href="dpu__offload__types_8h.html#abdda2bc51909d3f2e98a5c9dde42b0a8">offloading_engine_t</a> *, <a class="el" href="dpu__offload__types_8h.html#a42c35bf5c92dc98cf22a4818b0331608">init_params_t</a> *)</td></tr>
<tr class="memdesc:ac0389e761e688d7377daf019885f09fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">client_init initialize the datastructure representing a client and perform the bootstrapping procedure  <a href="inter__dpus__comm_8c.html#ac0389e761e688d7377daf019885f09fe">More...</a><br /></td></tr>
<tr class="separator:ac0389e761e688d7377daf019885f09fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af49c49a6e987b7de7b00c18cb16349c5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="dpu__offload__common_8h.html#a2f49d8c1f5f6182b5128dfd3c815c3ef">dpu_offload_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inter__dpus__comm_8c.html#af49c49a6e987b7de7b00c18cb16349c5">dpu_offload_parse_list_dpus</a> (<a class="el" href="dpu__offload__types_8h.html#abdda2bc51909d3f2e98a5c9dde42b0a8">offloading_engine_t</a> *engine, <a class="el" href="dpu__offload__types_8h.html#a7d930a5e992bf8d542cb50a0f11a6276">offloading_config_t</a> *config_data)</td></tr>
<tr class="memdesc:af49c49a6e987b7de7b00c18cb16349c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">dpu_offload_parse_list_dpus parses the list of DPUs to know how service processes are supposed to connect to each other. From the list of DPUs and the number of service processes per DPU, we know the total number of service processes and can order them based on the context of the configuration files. All service processes before the current service processwill connect to it, those after will connect to them. If the hostname of the system is not in the list, the list is assumed not applicable and DO_NOT_APPLICABLE is returned. Note that the function gathers the list of the DPUs' hostname and prepare the structures for all the service processes. The details are extracted while parsing the configuration file or other environment variables.  <a href="inter__dpus__comm_8c.html#af49c49a6e987b7de7b00c18cb16349c5">More...</a><br /></td></tr>
<tr class="separator:af49c49a6e987b7de7b00c18cb16349c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7aa92d4533c6f2bb8027945febdf7b2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inter__dpus__comm_8c.html#ab7aa92d4533c6f2bb8027945febdf7b2">connected_to_server_dpu</a> (void *data)</td></tr>
<tr class="memdesc:ab7aa92d4533c6f2bb8027945febdf7b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback invoked when a connection to a remote server running in the context of service process on a DPU completes. This is executed in the context of clients on DPUs that are used to connect to servers on other DPUs. In other words, client-&gt;connected_cb is set to this pointer.  <a href="inter__dpus__comm_8c.html#ab7aa92d4533c6f2bb8027945febdf7b2">More...</a><br /></td></tr>
<tr class="separator:ab7aa92d4533c6f2bb8027945febdf7b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61a24adad1d41eb35e3de8e2e5f9cdbe"><td class="memItemLeft" align="right" valign="top"><a class="el" href="dpu__offload__common_8h.html#a2f49d8c1f5f6182b5128dfd3c815c3ef">dpu_offload_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inter__dpus__comm_8c.html#a61a24adad1d41eb35e3de8e2e5f9cdbe">connect_to_remote_service_proc</a> (<a class="el" href="dpu__offload__types_8h.html#a709bd88b064e6b5c79548ccd5f1b9798">remote_service_proc_info_t</a> *<a class="el" href="structremote__service__proc__info.html">remote_service_proc_info</a>)</td></tr>
<tr class="separator:a61a24adad1d41eb35e3de8e2e5f9cdbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb1d65246b284a9a88cff22051d3485e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inter__dpus__comm_8c.html#adb1d65246b284a9a88cff22051d3485e">client_service_proc_connected</a> (void *data)</td></tr>
<tr class="memdesc:adb1d65246b284a9a88cff22051d3485e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback invoked when a client service process finalizes its connection to us. This is set on server service processes running on DPUs that are used to let client service processes connect. In other words, server-&gt;connected_cb is set to this pointer.  <a href="inter__dpus__comm_8c.html#adb1d65246b284a9a88cff22051d3485e">More...</a><br /></td></tr>
<tr class="separator:adb1d65246b284a9a88cff22051d3485e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7dffca90f97a06f0e19aee3d1ea5680c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="dpu__offload__common_8h.html#a2f49d8c1f5f6182b5128dfd3c815c3ef">dpu_offload_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inter__dpus__comm_8c.html#a7dffca90f97a06f0e19aee3d1ea5680c">inter_dpus_connect_mgr</a> (<a class="el" href="dpu__offload__types_8h.html#abdda2bc51909d3f2e98a5c9dde42b0a8">offloading_engine_t</a> *engine, <a class="el" href="dpu__offload__types_8h.html#a7d930a5e992bf8d542cb50a0f11a6276">offloading_config_t</a> *cfg)</td></tr>
<tr class="separator:a7dffca90f97a06f0e19aee3d1ea5680c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b8996936c9f3db7bbb24707f8c11247"><td class="memItemLeft" align="right" valign="top"><a class="el" href="dpu__offload__common_8h.html#a2f49d8c1f5f6182b5128dfd3c815c3ef">dpu_offload_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inter__dpus__comm_8c.html#a5b8996936c9f3db7bbb24707f8c11247">get_dpu_config</a> (<a class="el" href="dpu__offload__types_8h.html#abdda2bc51909d3f2e98a5c9dde42b0a8">offloading_engine_t</a> *offload_engine, <a class="el" href="dpu__offload__types_8h.html#a7d930a5e992bf8d542cb50a0f11a6276">offloading_config_t</a> *config_data)</td></tr>
<tr class="memdesc:a5b8996936c9f3db7bbb24707f8c11247"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the DPU config object based on the content of the configuration file.  <a href="inter__dpus__comm_8c.html#a5b8996936c9f3db7bbb24707f8c11247">More...</a><br /></td></tr>
<tr class="separator:a5b8996936c9f3db7bbb24707f8c11247"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a235b67257cbc555f548cdbe94b2efa6b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="dpu__offload__types_8h.html#a6846f687a61323898ab2f6903ca8766e">rank_info_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="inter__dpus__comm_8c.html#a235b67257cbc555f548cdbe94b2efa6b">invalid_group_rank</a></td></tr>
<tr class="memdesc:a235b67257cbc555f548cdbe94b2efa6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">invalid_group_rank is used when there is a need to exchange a group/rank but the current context does not have one. It is for instance used during the inter-dpu connections.  <a href="inter__dpus__comm_8c.html#a235b67257cbc555f548cdbe94b2efa6b">More...</a><br /></td></tr>
<tr class="separator:a235b67257cbc555f548cdbe94b2efa6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a3024ccd4a9af5109d24e6c57565d74a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3024ccd4a9af5109d24e6c57565d74a1">&#9670;&nbsp;</a></span>_POSIX_C_SOURCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _POSIX_C_SOURCE&#160;&#160;&#160;200809L</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a580d72718c40903a23a49390e599681b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a580d72718c40903a23a49390e599681b">&#9670;&nbsp;</a></span>ADD_LOCAL_SPS_TO_DPU_CONFIG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADD_LOCAL_SPS_TO_DPU_CONFIG</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_cfg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_dpu&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">do</span>                                                                                                       \</div>
<div class="line">    {                                                                                                        \</div>
<div class="line">        size_t _x;                                                                                           \</div>
<div class="line">        for (_x = 0; _x &lt; (_cfg)-&gt;num_service_procs_per_dpu; _x++)                                           \</div>
<div class="line">        {                                                                                                    \</div>
<div class="line">            uint64_t _sp_gid = (_dpu)-&gt;idx * (_cfg)-&gt;num_service_procs_per_dpu + _x;                         \</div>
<div class="line">            remote_service_proc_info_t *_sp = <a class="code" href="dynamic__structs_8h.html#a0e5fa3cb758f3eefad714235c1fef266">DYN_ARRAY_GET_ELT</a>(&amp;((_cfg)-&gt;<a class="code" href="structoffloading__engine.html">offloading_engine</a>-&gt;<a class="code" href="structoffloading__engine.html#aa83f08c1fa7b35c109566c176ef5c3eb">service_procs</a>), \</div>
<div class="line">                                                                _sp_gid,                                     \</div>
<div class="line">                                                                <a class="code" href="structremote__service__proc__info.html">remote_service_proc_info_t</a>);                 \</div>
<div class="line">            assert(_sp);                                                                                     \</div>
<div class="line">            _sp-&gt;idx = _sp_gid;                                                                              \</div>
<div class="line">            conn_params_t *_sp_conn_params;                                                                  \</div>
<div class="line">            DYN_LIST_GET((_cfg)-&gt;<a class="code" href="structoffloading__engine.html">offloading_engine</a>-&gt;<a class="code" href="structoffloading__engine.html#ab73161186f9c864cfcaa2edbbc86fd53">pool_conn_params</a>, <a class="code" href="structconn__params.html">conn_params_t</a>, item, _sp_conn_params); \</div>
<div class="line">            assert(_sp_conn_params);                                                                         \</div>
<div class="line">            RESET_CONN_PARAMS(_sp_conn_params);                                                              \</div>
<div class="line">            _sp-&gt;dpu = (_dpu);                                                                               \</div>
<div class="line">            _sp-&gt;init_params.conn_params = _sp_conn_params;                                                  \</div>
<div class="line">            _sp-&gt;service_proc.local_id = _x;                                                                 \</div>
<div class="line">            _sp-&gt;service_proc.global_id = _sp_gid;                                                           \</div>
<div class="line">            _sp-&gt;offload_engine = (_cfg)-&gt;<a class="code" href="structoffloading__engine.html">offloading_engine</a>;                                                 \</div>
<div class="line">            SIMPLE_LIST_PREPEND(&amp;((_dpu)-&gt;remote_service_procs), &amp;(_sp-&gt;item));                              \</div>
<div class="line">        }                                                                                                    \</div>
<div class="line">    } <span class="keywordflow">while</span> (0)</div>
<div class="ttc" id="adynamic__structs_8h_html_a0e5fa3cb758f3eefad714235c1fef266"><div class="ttname"><a href="dynamic__structs_8h.html#a0e5fa3cb758f3eefad714235c1fef266">DYN_ARRAY_GET_ELT</a></div><div class="ttdeci">#define DYN_ARRAY_GET_ELT(_dyn_array, _idx, _type)</div><div class="ttdef"><b>Definition:</b> dynamic_structs.h:174</div></div>
<div class="ttc" id="astructconn__params_html"><div class="ttname"><a href="structconn__params.html">conn_params</a></div><div class="ttdef"><b>Definition:</b> dpu_offload_types.h:846</div></div>
<div class="ttc" id="astructoffloading__engine_html"><div class="ttname"><a href="structoffloading__engine.html">offloading_engine</a></div><div class="ttdef"><b>Definition:</b> dpu_offload_types.h:1739</div></div>
<div class="ttc" id="astructoffloading__engine_html_aa83f08c1fa7b35c109566c176ef5c3eb"><div class="ttname"><a href="structoffloading__engine.html#aa83f08c1fa7b35c109566c176ef5c3eb">offloading_engine::service_procs</a></div><div class="ttdeci">dyn_array_t service_procs</div><div class="ttdef"><b>Definition:</b> dpu_offload_types.h:1817</div></div>
<div class="ttc" id="astructoffloading__engine_html_ab73161186f9c864cfcaa2edbbc86fd53"><div class="ttname"><a href="structoffloading__engine.html#ab73161186f9c864cfcaa2edbbc86fd53">offloading_engine::pool_conn_params</a></div><div class="ttdeci">dyn_list_t * pool_conn_params</div><div class="ttdef"><b>Definition:</b> dpu_offload_types.h:1800</div></div>
<div class="ttc" id="astructremote__service__proc__info_html"><div class="ttname"><a href="structremote__service__proc__info.html">remote_service_proc_info</a></div><div class="ttdoc">Datatstructure representing a remote service process that is running on a specific DPU....</div><div class="ttdef"><b>Definition:</b> dpu_offload_types.h:2344</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aff962075df7d2346d199623f022419c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff962075df7d2346d199623f022419c6">&#9670;&nbsp;</a></span>SET_REMOTE_SP_TO_CONNECT_TO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SET_REMOTE_SP_TO_CONNECT_TO</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_cfg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_sp_gid&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">do</span>                                                                                        \</div>
<div class="line">    {                                                                                         \</div>
<div class="line">        remote_service_proc_info_t *sp_connect_to = NULL;                                     \</div>
<div class="line">        sp_connect_to = <a class="code" href="dynamic__structs_8h.html#a0e5fa3cb758f3eefad714235c1fef266">DYN_ARRAY_GET_ELT</a>(&amp;((_cfg)-&gt;<a class="code" href="structoffloading__engine.html">offloading_engine</a>-&gt;<a class="code" href="structoffloading__engine.html#aa83f08c1fa7b35c109566c176ef5c3eb">service_procs</a>),        \</div>
<div class="line">                                          _sp_gid,                                            \</div>
<div class="line">                                          <a class="code" href="structremote__service__proc__info.html">remote_service_proc_info_t</a>);                        \</div>
<div class="line">        assert(sp_connect_to);                                                                \</div>
<div class="line">        assert(sp_connect_to-&gt;init_params.conn_params);                                       \</div>
<div class="line">        connect_to_service_proc_t *sp_conn_to;                                                \</div>
<div class="line">        DYN_LIST_GET((_cfg)-&gt;info_connecting_to.pool_remote_sp_connect_to,                    \</div>
<div class="line">                     <a class="code" href="structconnect__to__service__proc.html">connect_to_service_proc_t</a>,                                               \</div>
<div class="line">                     item,                                                                    \</div>
<div class="line">                     sp_conn_to);                                                             \</div>
<div class="line">        assert(sp_conn_to);                                                                   \</div>
<div class="line">        sp_conn_to-&gt;sp = sp_connect_to;                                                       \</div>
<div class="line">        <span class="comment">/* Connection details are set while parsing the config file */</span>                        \</div>
<div class="line">        ucs_list_add_tail(&amp;((_cfg)-&gt;info_connecting_to.sps_connect_to), &amp;(sp_conn_to-&gt;item)); \</div>
<div class="line">    } <span class="keywordflow">while</span> (0)</div>
<div class="ttc" id="astructconnect__to__service__proc_html"><div class="ttname"><a href="structconnect__to__service__proc.html">connect_to_service_proc</a></div><div class="ttdoc">While the remote_service_proc_info_t structure is ready to be used as a list item,...</div><div class="ttdef"><b>Definition:</b> dpu_offload_types.h:2413</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8e6fbbe70d686f5c32e4399bfd9c4090"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e6fbbe70d686f5c32e4399bfd9c4090">&#9670;&nbsp;</a></span>SET_SERVICE_PROC_TO_CONNECT_TO</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SET_SERVICE_PROC_TO_CONNECT_TO</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_engine, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_cfg, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_remote_dpu&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">do</span>                                                                                          \</div>
<div class="line">    {                                                                                           \</div>
<div class="line">        size_t _s;                                                                              \</div>
<div class="line">        ADD_LOCAL_SPS_TO_DPU_CONFIG((_cfg), _remote_dpu);                                       \</div>
<div class="line">        ucs_list_add_tail(&amp;((_cfg)-&gt;info_connecting_to.dpus_connect_to), &amp;(_remote_dpu-&gt;item)); \</div>
<div class="line">        for (_s = 0; _s &lt; (_cfg)-&gt;num_service_procs_per_dpu; _s++)                              \</div>
<div class="line">        {                                                                                       \</div>
<div class="line">            uint64_t sp_global_id = _remote_dpu-&gt;idx * (_cfg)-&gt;num_service_procs_per_dpu + _s;  \</div>
<div class="line">            SET_REMOTE_SP_TO_CONNECT_TO(_cfg, sp_global_id);                                    \</div>
<div class="line">        }                                                                                       \</div>
<div class="line">        (_cfg)-&gt;info_connecting_to.num_dpus++;                                                  \</div>
<div class="line">        (_cfg)-&gt;info_connecting_to.num_connect_to += (_cfg)-&gt;num_service_procs_per_dpu;         \</div>
<div class="line">    } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ac0389e761e688d7377daf019885f09fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0389e761e688d7377daf019885f09fe">&#9670;&nbsp;</a></span>client_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dpu__offload__types_8h.html#ac95b2624b57c0005e3ca8a740316e5ab">execution_context_t</a>* client_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="dpu__offload__types_8h.html#abdda2bc51909d3f2e98a5c9dde42b0a8">offloading_engine_t</a> *&#160;</td>
          <td class="paramname"><em>offload_engine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="dpu__offload__types_8h.html#a42c35bf5c92dc98cf22a4818b0331608">init_params_t</a> *&#160;</td>
          <td class="paramname"><em>init_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>client_init initialize the datastructure representing a client and perform the bootstrapping procedure </p>
<p>client_init creates and returns a new execution context object that can later on be used as a client. Trying to use it as a server is invalid.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">offload_engine</td><td>offloading engine the client is associated with. </td></tr>
    <tr><td class="paramname"><a class="el" href="structinit__params.html">init_params</a></td><td>Handle gathering all the initialization parameters that can be customized by the caller. Can be NULL to use defaults. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution_context_t* </dd></dl>

</div>
</div>
<a id="adb1d65246b284a9a88cff22051d3485e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb1d65246b284a9a88cff22051d3485e">&#9670;&nbsp;</a></span>client_service_proc_connected()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void client_service_proc_connected </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback invoked when a client service process finalizes its connection to us. This is set on server service processes running on DPUs that are used to let client service processes connect. In other words, server-&gt;connected_cb is set to this pointer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>DPU data </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a61a24adad1d41eb35e3de8e2e5f9cdbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61a24adad1d41eb35e3de8e2e5f9cdbe">&#9670;&nbsp;</a></span>connect_to_remote_service_proc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dpu__offload__common_8h.html#a2f49d8c1f5f6182b5128dfd3c815c3ef">dpu_offload_status_t</a> connect_to_remote_service_proc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="dpu__offload__types_8h.html#a709bd88b064e6b5c79548ccd5f1b9798">remote_service_proc_info_t</a> *&#160;</td>
          <td class="paramname"><em>remote_service_proc_info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab7aa92d4533c6f2bb8027945febdf7b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7aa92d4533c6f2bb8027945febdf7b2">&#9670;&nbsp;</a></span>connected_to_server_dpu()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void connected_to_server_dpu </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback invoked when a connection to a remote server running in the context of service process on a DPU completes. This is executed in the context of clients on DPUs that are used to connect to servers on other DPUs. In other words, client-&gt;connected_cb is set to this pointer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Generic pointer to pass callback data </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af49c49a6e987b7de7b00c18cb16349c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af49c49a6e987b7de7b00c18cb16349c5">&#9670;&nbsp;</a></span>dpu_offload_parse_list_dpus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dpu__offload__common_8h.html#a2f49d8c1f5f6182b5128dfd3c815c3ef">dpu_offload_status_t</a> dpu_offload_parse_list_dpus </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="dpu__offload__types_8h.html#abdda2bc51909d3f2e98a5c9dde42b0a8">offloading_engine_t</a> *&#160;</td>
          <td class="paramname"><em>engine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="dpu__offload__types_8h.html#a7d930a5e992bf8d542cb50a0f11a6276">offloading_config_t</a> *&#160;</td>
          <td class="paramname"><em>config_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>dpu_offload_parse_list_dpus parses the list of DPUs to know how service processes are supposed to connect to each other. From the list of DPUs and the number of service processes per DPU, we know the total number of service processes and can order them based on the context of the configuration files. All service processes before the current service processwill connect to it, those after will connect to them. If the hostname of the system is not in the list, the list is assumed not applicable and DO_NOT_APPLICABLE is returned. Note that the function gathers the list of the DPUs' hostname and prepare the structures for all the service processes. The details are extracted while parsing the configuration file or other environment variables. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">engine</td><td>The offloading engine associated to the function call. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">config_data</td><td>All the configuration details from which we get the list of DPUs and where the result is stored </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>dpu_offload_status_t </dd></dl>

</div>
</div>
<a id="a5b8996936c9f3db7bbb24707f8c11247"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b8996936c9f3db7bbb24707f8c11247">&#9670;&nbsp;</a></span>get_dpu_config()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dpu__offload__common_8h.html#a2f49d8c1f5f6182b5128dfd3c815c3ef">dpu_offload_status_t</a> get_dpu_config </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="dpu__offload__types_8h.html#abdda2bc51909d3f2e98a5c9dde42b0a8">offloading_engine_t</a> *&#160;</td>
          <td class="paramname"><em>offload_engine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="dpu__offload__types_8h.html#a7d930a5e992bf8d542cb50a0f11a6276">offloading_config_t</a> *&#160;</td>
          <td class="paramname"><em>config_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the DPU config object based on the content of the configuration file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="structoffloading__engine.html">offloading_engine</a></td><td>The offloading engine to configure with the configuration file. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">[in/out]</td><td>dpu_config Configuration details for all the DPUs from the configuration file. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>dpu_offload_status_t </dd></dl>

</div>
</div>
<a id="a7dffca90f97a06f0e19aee3d1ea5680c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7dffca90f97a06f0e19aee3d1ea5680c">&#9670;&nbsp;</a></span>inter_dpus_connect_mgr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dpu__offload__common_8h.html#a2f49d8c1f5f6182b5128dfd3c815c3ef">dpu_offload_status_t</a> inter_dpus_connect_mgr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="dpu__offload__types_8h.html#abdda2bc51909d3f2e98a5c9dde42b0a8">offloading_engine_t</a> *&#160;</td>
          <td class="paramname"><em>engine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="dpu__offload__types_8h.html#a7d930a5e992bf8d542cb50a0f11a6276">offloading_config_t</a> *&#160;</td>
          <td class="paramname"><em>cfg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab07bde402553cc60ac536d085b3623b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab07bde402553cc60ac536d085b3623b3">&#9670;&nbsp;</a></span>server_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dpu__offload__types_8h.html#ac95b2624b57c0005e3ca8a740316e5ab">execution_context_t</a>* server_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="dpu__offload__types_8h.html#abdda2bc51909d3f2e98a5c9dde42b0a8">offloading_engine_t</a> *&#160;</td>
          <td class="paramname"><em>offloading_engine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="dpu__offload__types_8h.html#a42c35bf5c92dc98cf22a4818b0331608">init_params_t</a> *&#160;</td>
          <td class="paramname"><em>init_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a connection server. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"><a class="el" href="structoffloading__engine.html">offloading_engine</a></td><td>Associated offloading engine. </td></tr>
    <tr><td class="paramname"><a class="el" href="structconn__params.html">conn_params</a></td><td>Connection parameters, e.g., port to use to listen for connections. If NULL, the configuration will be pulled from environment variables. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>execution_context_t* </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a235b67257cbc555f548cdbe94b2efa6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a235b67257cbc555f548cdbe94b2efa6b">&#9670;&nbsp;</a></span>invalid_group_rank</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="dpu__offload__types_8h.html#a6846f687a61323898ab2f6903ca8766e">rank_info_t</a> invalid_group_rank</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    .group_id = {</div>
<div class="line">        .id = <a class="code" href="dpu__offload__types_8h.html#a4659a930c6e544561277e47132d5e778">INVALID_GROUP</a>,</div>
<div class="line">        .lead = <a class="code" href="dpu__offload__types_8h.html#a05909c835ada8545c0042f78a77eb310">INVALID_GROUP_LEAD</a>,</div>
<div class="line">    },</div>
<div class="line">    .group_rank = <a class="code" href="dpu__offload__types_8h.html#aaebbae3dc2ca01da62bd2d8d819f17c1">INVALID_RANK</a>,</div>
<div class="line">}</div>
<div class="ttc" id="adpu__offload__types_8h_html_a05909c835ada8545c0042f78a77eb310"><div class="ttname"><a href="dpu__offload__types_8h.html#a05909c835ada8545c0042f78a77eb310">INVALID_GROUP_LEAD</a></div><div class="ttdeci">#define INVALID_GROUP_LEAD</div><div class="ttdef"><b>Definition:</b> dpu_offload_types.h:258</div></div>
<div class="ttc" id="adpu__offload__types_8h_html_a4659a930c6e544561277e47132d5e778"><div class="ttname"><a href="dpu__offload__types_8h.html#a4659a930c6e544561277e47132d5e778">INVALID_GROUP</a></div><div class="ttdeci">#define INVALID_GROUP</div><div class="ttdef"><b>Definition:</b> dpu_offload_types.h:259</div></div>
<div class="ttc" id="adpu__offload__types_8h_html_aaebbae3dc2ca01da62bd2d8d819f17c1"><div class="ttname"><a href="dpu__offload__types_8h.html#aaebbae3dc2ca01da62bd2d8d819f17c1">INVALID_RANK</a></div><div class="ttdeci">#define INVALID_RANK</div><div class="ttdef"><b>Definition:</b> dpu_offload_types.h:260</div></div>
</div><!-- fragment -->
<p>invalid_group_rank is used when there is a need to exchange a group/rank but the current context does not have one. It is for instance used during the inter-dpu connections. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
